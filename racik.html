<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buat Parfum â€“ MixScent</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- ðŸ’¡ Gaya Desain (Modern Rose Gold - Selaras) --- */
        
        :root {
            --color-bg-light: #FFFFFF;
            --color-bg-alt: #FFFBF9;
            --color-text-dark: #4A4A4A;
            --color-text-light: #7A7A7A;
            --color-accent-gold: #D9AAB7;
            --color-accent-gold-hover: #C48F9E;
            --color-border: #F5EAEB;
            --color-footer-bg: #4A4A4A;
            --color-danger: #d9534f;

            --font-heading: 'Playfair Display', serif;
            --font-body: 'Poppins', sans-serif;
            --font-ui: 'Montserrat', sans-serif;
            
            --border-radius: 8px;
            --shadow-subtle: 0 5px 20px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.08);
            
            --header-height: 70px;
        }
        
        /* --- Reset Dasar --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-body);
            background-color: var(--color-bg-alt);
            color: var(--color-text-dark);
            line-height: 1.7;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main {
            flex-grow: 1; 
        }
        h1, h2, h3, h4 { font-family: var(--font-heading); font-weight: 700; }
        h2 { font-size: 2.8rem; text-align: center; margin-bottom: 2.5rem; }
        h3 { font-size: 1.5rem; margin-bottom: 0.75rem; }
        p { font-size: 1rem; color: var(--color-text-light); margin-bottom: 1.5rem; }
        a { text-decoration: none; color: var(--color-accent-gold); transition: color 0.3s ease; }
        a:hover { color: var(--color-accent-gold-hover); }
        .container { max-width: 1140px; margin: 0 auto; padding: 4rem 2rem; }
        
        /* --- Tombol CTA --- */
        .btn {
            display: inline-block;
            padding: 0.8rem 2.2rem;
            border-radius: 50px;
            font-weight: 600;
            font-family: var(--font-ui);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }
        .btn-primary {
            background-color: var(--color-accent-gold);
            color: #fff;
            border-color: var(--color-accent-gold);
        }
        .btn-primary:hover {
            background-color: var(--color-accent-gold-hover);
            border-color: var(--color-accent-gold-hover);
            color: #fff;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: transparent;
            color: var(--color-accent-gold);
            border-color: var(--color-accent-gold);
        }
        .btn-secondary:hover {
            background-color: var(--color-accent-gold);
            color: #fff;
        }

        /* --- Header / Navbar --- */
        #main-header {
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background-color: var(--color-bg-light);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.06);
            height: var(--header-height);
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1280px;
            height: 100%;
            margin: 0 auto;
            padding: 0 2rem;
        }
        #main-header .logo {
            font-size: 1.8rem;
            font-family: var(--font-heading);
            color: var(--color-text-dark);
            font-weight: 700;
        }
        #main-header nav { display: none; }
        #main-header nav ul { list-style: none; display: flex; align-items: center; }
        #main-header nav li { margin: 0 1.25rem; }
        #main-header nav a {
            font-family: var(--font-ui);
            font-weight: 500;
            color: var(--color-text-light);
            font-size: 0.9rem;
        }
        #main-header nav a:hover,
        #main-header nav a.active { color: var(--color-text-dark); }
        .nav-cta {
            margin-left: 1.5rem;
            padding: 0.6rem 1.5rem;
            font-size: 0.9rem;
        }
        @media (min-width: 769px) {
            #main-header nav { display: block; }
        }

        /* --- Layout Halaman Builder --- */
        .builder-layout {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 3rem;
            align-items: flex-start;
        }
        
        /* Kolom Kiri (Visual & Info) */
        .builder-visual {
            position: sticky;
            top: 100px;
            background: var(--color-bg-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            border: 1px solid var(--color-border);
            padding: 2rem;
        }
        .bottle-visual {
            width: 150px;
            height: 250px;
            border: 2px solid var(--color-border);
            border-radius: 25px 25px 8px 8px;
            margin: 1rem auto 2rem auto;
            background: #fdfdfd;
            display: flex;
            flex-direction: column-reverse;
            overflow: hidden;
        }
        .bottle-layer {
            width: 100%;
            height: 0;
            transition: height 0.5s ease, background-color 0.5s ease;
        }
        
        .form-group { margin-bottom: 1.5rem; }
        .form-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-family: var(--font-ui);
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--color-text-dark);
        }
        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius);
            font-family: var(--font-body);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        .form-group input[type="text"]:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-accent-gold);
        }
        .form-group textarea { min-height: 80px; resize: vertical; }
        
        .radio-option-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 0.5rem;
        }
        
        .radio-option-group-ketahanan {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        
        .radio-option {
            display: block;
            padding: 0.75rem 0.25rem; 
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .radio-option:hover { border-color: var(--color-accent-gold-hover); }
        .radio-option input { display: none; }
        .radio-option:has(input:checked) {
            border-color: var(--color-accent-gold);
            background-color: var(--color-bg-alt);
        }
        .radio-option strong {
            font-family: var(--font-ui);
            font-size: 0.9rem; 
            color: var(--color-text-dark);
        }
        
        /* Kolom Kanan (Kontrol Racikan) */
        .builder-controls {
            background: var(--color-bg-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            border: 1px solid var(--color-border);
            padding: 2rem;
        }
        .builder-controls h2 {
            font-size: 2rem;
            text-align: left;
            margin: 0 0 1.5rem 0;
        }

        #aroma-slots-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .aroma-slot {
            padding: 1.5rem;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            background: #fff;
        }
        .aroma-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .aroma-name {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            color: var(--color-text-dark);
            font-weight: 700;
        }
        .btn-remove-aroma {
            font-size: 0.8rem;
            color: var(--color-danger);
            cursor: pointer;
            font-family: var(--font-ui);
            font-weight: 600;
            background: none;
            border: none;
            padding: 0;
        }
        .btn-remove-aroma:hover { text-decoration: underline; }

        .aroma-slider-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .aroma-slider {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--color-border);
            outline: none;
            border-radius: 5px;
        }
        .aroma-slider::-webkit-slider-thumb,
        .aroma-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-accent-gold);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .aroma-slider:hover::-webkit-slider-thumb { background: var(--color-accent-gold-hover); }

        .aroma-value-display {
            display: flex;
            gap: 0.5rem;
            font-family: var(--font-ui);
            font-weight: 600;
        }
        .aroma-value-display .aroma-ml {
            width: 60px;
            text-align: right;
            border: none;
            background: var(--color-bg-alt);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-weight: 600;
            color: var(--color-text-dark);
            font-size: 0.9rem; 
        }
        .aroma-value-display .aroma-percent {
            width: 45px;
            text-align: right;
            color: var(--color-text-light);
            font-size: 0.9rem; 
        }

        #add-aroma-btn {
            display: block;
            width: 100%;
            padding: 1.5rem;
            border: 2px dashed var(--color-border);
            background: var(--color-bg-alt);
            color: var(--color-text-light);
            font-family: var(--font-ui);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #add-aroma-btn:hover {
            border-color: var(--color-accent-gold);
            color: var(--color-accent-gold-hover);
            box-shadow: var(--shadow-subtle);
        }
        
        /* Total Bar & Tombol Aksi */
        .total-bar-container {
            padding-top: 1rem;
            border-top: 1px solid var(--color-border);
            margin-top: 2rem;
        }
        .total-bar-label {
            display: flex;
            justify-content: space-between;
            font-family: var(--font-ui);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        #total-percent-text { color: var(--color-danger); }
        .total-bar {
            width: 100%;
            height: 12px;
            background-color: var(--color-border);
            border-radius: 10px;
            overflow: hidden;
        }
        #total-progress-bar {
            width: 0%;
            height: 100%;
            background-color: var(--color-accent-gold);
            transition: width 0.4s ease;
        }
        #total-warning {
            font-size: 0.9rem;
            color: var(--color-danger);
            text-align: center;
            margin-top: 0.5rem;
            display: block; 
        }

        /* [BARU] Price Display Style */
        .price-display {
            background: var(--color-bg-alt);
            border: 1px solid var(--color-accent-gold);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            text-align: right;
            font-family: var(--font-heading);
            color: var(--color-text-dark);
            font-size: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .price-display span {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-accent-gold-hover);
        }

        .builder-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .builder-actions .btn { flex: 1; }
        .builder-actions .btn:disabled {
            background-color: #ccc;
            border-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* --- Modal Pop-up Katalog --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); 
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 1rem;
        }
        .modal-content {
            background-color: var(--color-bg-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            max-width: 800px;
            width: 100%;
            height: 90vh;
            display: flex;
            flex-direction: column;
            animation: modalFadeIn 0.3s ease-out;
        }
        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2 {
            font-family: var(--font-heading);
            font-size: 2rem;
            text-align: left;
            margin: 0;
            color: var(--color-text-dark);
        }
        .modal-close-btn {
            font-size: 2.5rem;
            color: var(--color-text-light);
            cursor: pointer;
            line-height: 1;
            font-weight: 300;
        }
        .modal-close-btn:hover { color: var(--color-text-dark); }
        
        .modal-body {
            padding: 1.5rem 2rem;
            overflow-y: auto;
            flex-grow: 1;
        }
        .aroma-picker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .aroma-choice {
            background-color: var(--color-bg-light);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .aroma-choice:hover {
            border-color: var(--color-accent-gold);
            transform: translateY(-3px);
            box-shadow: var(--shadow-subtle);
        }
        .aroma-choice h4 {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            color: var(--color-text-dark);
        }
        .aroma-choice p {
            font-size: 0.85rem;
            margin-bottom: 0;
            color: var(--color-text-light);
        }
        
        /* --- Footer --- */
        footer {
            background-color: var(--color-footer-bg);
            color: #ccc;
            padding: 5rem 2rem 2rem 2rem;
            margin-top: auto; 
        }
        .footer-container {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 2.5rem;
            max-width: 1140px;
            margin: 0 auto 3rem auto;
        }
        .footer-logo { font-size: 1.8rem; font-family: var(--font-heading); color: #fff; margin-bottom: 1rem; }
        .footer-about p { color: #999; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .social-icons a { color: #999; font-size: 1.5rem; margin-right: 1.5rem; }
        .social-icons a:hover { color: var(--color-bg-light); }
        .footer-links h4 { font-family: var(--font-ui); font-size: 1.1rem; color: #fff; margin-bottom: 1.5rem; }
        .footer-links ul { list-style: none; }
        .footer-links li { margin-bottom: 0.75rem; }
        .footer-links a { color: #999; font-size: 0.9rem; }
        .footer-links a:hover { color: #fff; }
        .copyright { text-align: center; padding-top: 2rem; border-top: 1px solid #333; font-size: 0.9rem; color: #777; max-width: 1140px; margin: 0 auto; }
        
        @media (max-width: 992px) {
            .builder-layout { grid-template-columns: 1fr; }
            .builder-visual { position: static; top: auto; }
            .footer-container { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 768px) {
            .footer-container { grid-template-columns: 1fr; }
            .aroma-slider-group { flex-wrap: wrap; }
            .aroma-slider { width: 100%; flex-grow: 0; margin-bottom: 0.5rem; }
            .modal-content { height: 80vh; padding: 1.5rem; }
        }
        @media (max-width: 480px) {
            .radio-option-group { grid-template-columns: repeat(auto-fit, minmax(50px, 1fr)); }
            .radio-option-group-ketahanan { grid-template-columns: 1fr 1fr; }
        }

    </style>
</head>
<body>

    <header id="main-header">
        <div class="header-container">
            <a href="beranda.html" class="logo">MixScent</a>
            <nav>
                <ul>
                    <li><a href="beranda.html">Beranda</a></li>
                    <li><a href="tentangkami.html">Tentang</a></li>
                    <li><a href="buatparfum.html">Katalog Aroma</a></li>
                    <li><a href="rekomendasi.html">Rekomendasi</a></li>
                    <li><a href="resepku.html" class="active">Resepku</a></li>
                </ul>
            </nav>
            <a href="profil.html" class="btn btn-primary nav-cta">Profil Saya</a>
        </div>
    </header>

    <main>
        <section class="container">
            <div class="builder-layout">
                
                <aside class="builder-visual">
                    <div class="bottle-visual" id="bottle-visual"></div>
                    
                    <div class="form-group">
                        <label>Pilih Ukuran Botol</label>
                        <div class="radio-option-group">
                            <label class="radio-option"><input type="radio" name="bottle-size" value="5"><strong>5 ml</strong></label>
                            <label class="radio-option"><input type="radio" name="bottle-size" value="8"><strong>8 ml</strong></label>
                            <label class="radio-option"><input type="radio" name="bottle-size" value="13"><strong>13 ml</strong></label>
                            <label class="radio-option"><input type="radio" name="bottle-size" value="15"><strong>15 ml</strong></label>
                            <label class="radio-option"><input type="radio" name="bottle-size" value="30"><strong>30 ml</strong></label>
                            <label class="radio-option"><input type="radio" name="bottle-size" value="60"><strong>60 ml</strong></label>
                            <label class="radio-option"><input type="radio" name="bottle-size" value="100" checked><strong>100 ml</strong></label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Pilih Ketahanan Aroma (Konsentrat)</label>
                        <div class="radio-option-group-ketahanan">
                            <label class="radio-option"><input type="radio" name="ketahanan" value="3" checked><strong>3 Jam</strong></label>
                            <label class="radio-option"><input type="radio" name="ketahanan" value="8"><strong>8 Jam</strong></label>
                            <label class="radio-option"><input type="radio" name="ketahanan" value="12"><strong>12 Jam</strong></label>
                            <label class="radio-option"><input type="radio" name="ketahanan" value="24"><strong>24 Jam</strong></label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipe-name">Nama Racikan Anda</label>
                        <input type="text" id="recipe-name" name="recipe-name" placeholder="Contoh: Senja di Taman">
                    </div>
                    <div class="form-group">
                        <label for="recipe-notes">Catatan Pribadi (Opsional)</label>
                        <textarea id="recipe-notes" name="recipe-notes" placeholder="Contoh: Aroma untuk kencan, lembut & manis"></textarea>
                    </div>
                </aside>

                <div class="builder-controls">
                    <h2>Studio Racik</h2>
                    
                    <div id="aroma-slots-container"></div>

                    <button id="add-aroma-btn">+ Tambah Aroma</button>
                    
                    <div class="total-bar-container">
                        <div class="total-bar-label">
                            <span>Total Racikan</span>
                            <span id="total-percent-text">Total: 0% / 100%</span>
                        </div>
                        <div class="total-bar">
                            <div id="total-progress-bar" style="width: 0%;"></div>
                        </div>
                        <p id="total-warning" style="display: block;">Total racikan harus 100% untuk menyimpan.</p>
                    </div>

                    <div class="price-display">
                        Estimasi Harga: <span id="total-price">Rp 0</span>
                    </div>

                    <div class="builder-actions">
                        <button id="save-recipe-btn" class="btn btn-secondary" disabled>Simpan ke Resepku</button>
                        <button id="order-recipe-btn" class="btn btn-primary" disabled>Pesan Sekarang</button>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <div class="modal-overlay" id="aroma-picker-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Pilih Aroma</h2>
                <span class="modal-close-btn" id="modalCloseBtn">&times;</span>
            </div>
            <div class="modal-body">
                <div class="aroma-picker-grid">
                    <div class="aroma-choice" data-name="Vanilla Sky" data-color="#fff2cc"><h4>Vanilla Sky</h4><p>Base Note - Gourmand</p></div>
                    <div class="aroma-choice" data-name="Rose Petal" data-color="#f7cac9"><h4>Rose Petal</h4><p>Middle Note - Floral</p></div>
                    <div class="aroma-choice" data-name="Citrus Bloom" data-color="#f7f7a1"><h4>Citrus Bloom</h4><p>Top Note - Fresh</p></div>
                    <div class="aroma-choice" data-name="Deep Sandalwood" data-color="#e6cba8"><h4>Deep Sandalwood</h4><p>Base Note - Woody</p></div>
                    <div class="aroma-choice" data-name="Soft Musk" data-color="#f5f5f5"><h4>Soft Musk</h4><p>Base Note - Oriental</p></div>
                    <div class="aroma-choice" data-name="Jasmine Tea" data-color="#c5e0dc"><h4>Jasmine Tea</h4><p>Middle Note - Floral/Green</p></div>
                    <div class="aroma-choice" data-name="Amber Glow" data-color="#f7b78a"><h4>Amber Glow</h4><p>Base Note - Oriental</p></div>
                    <div class="aroma-choice" data-name="Fresh Laundry" data-color="#e0eef5"><h4>Fresh Laundry</h4><p>Top Note - Fresh</p></div>
                    <div class="aroma-choice" data-name="Ocean Breeze" data-color="#b3e0e2"><h4>Ocean Breeze</h4><p>Top Note - Fresh/Aquatic</p></div>
                    <div class="aroma-choice" data-name="Spicy Bergamot" data-color="#d4e2b3"><h4>Spicy Bergamot</h4><p>Top Note - Fresh/Spicy</p></div>
                    <div class="aroma-choice" data-name="Sweet Caramel" data-color="#e0b898"><h4>Sweet Caramel</h4><p>Base Note - Gourmand</p></div>
                    <div class="aroma-choice" data-name="Patchouli Earth" data-color="#d4a5a5"><h4>Patchouli Earth</h4><p>Base Note - Woody/Earthy</p></div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-about">
                <div class="footer-logo">MixScent</div>
                <p>Create Your Own Fragrance. <br> Racik, miliki, dan ekspresikan dirimu.</p>
                <div class="social-icons">
                    <a href="#" title="Instagram">I</a> <a href="#" title="TikTok">T</a> <a href="#" title="Twitter/X">X</a>
                </div>
            </div>
            <div class="footer-links">
                <h4>MixScent</h4>
                <ul>
                    <li><a href="tentangkami.html">Tentang</a></li>
                    <li><a href="buatparfum.html">Katalog Aroma</a></li>
                    <li><a href="rekomendasi.html">Rekomendasi</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>Bantuan</h4>
                <ul>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Hubungi Kami</a></li>
                    <li><a href="#">Privasi</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>Akun</h4>
                <ul>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="daftar.html">Daftar</a></li>
                    <li><a href="resepku.html">Resepku</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">Copyright Â© 2025 MixScent. All rights reserved.</div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const slotsContainer = document.getElementById('aroma-slots-container');
            const addAromaBtn = document.getElementById('add-aroma-btn');
            const bottleVisual = document.getElementById('bottle-visual');
            const bottleSizeRadios = document.querySelectorAll('input[name="bottle-size"]');
            const ketahananRadios = document.querySelectorAll('input[name="ketahanan"]'); // [BARU]
            const totalProgressBar = document.getElementById('total-progress-bar');
            const totalPercentText = document.getElementById('total-percent-text');
            const totalWarning = document.getElementById('total-warning');
            const totalPriceDisplay = document.getElementById('total-price'); // [BARU]
            const saveBtn = document.getElementById('save-recipe-btn');
            const orderBtn = document.getElementById('order-recipe-btn');
            const modal = document.getElementById('aroma-picker-modal');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const aromaChoices = document.querySelectorAll('.aroma-choice');
            
            let slotIdCounter = 0;

            // [BARU] Data Harga (Logika Sederhana)
            const BOTTLE_PRICES = {
                5: 10000,
                8: 15000,
                13: 25000,
                15: 30000,
                30: 50000,
                60: 80000,
                100: 120000
            };
            
            const ESSENCE_PRICE_PER_ML = 2000; // Harga bibit per ml

            const CONCENTRATION_PRICES = {
                3: 0,      // Standar
                8: 10000,  // Tambah awet
                12: 20000, // Tahan lama
                24: 30000  // Seharian
            };

            function openAromaModal() { modal.style.display = 'flex'; }
            function closeAromaModal() { modal.style.display = 'none'; }
            
            function getCurrentBottleSize() {
                return parseInt(document.querySelector('input[name="bottle-size"]:checked').value, 10);
            }

            function getCurrentConcentrationCost() {
                const val = parseInt(document.querySelector('input[name="ketahanan"]:checked').value, 10);
                return CONCENTRATION_PRICES[val] || 0;
            }

            function createAromaSlot(name, color) {
                slotIdCounter++;
                const slotId = `slot-${slotIdCounter}`;
                const slotDiv = document.createElement('div');
                slotDiv.className = 'aroma-slot';
                slotDiv.id = slotId;
                slotDiv.dataset.color = color; 
                slotDiv.innerHTML = `
                    <div class="aroma-header">
                        <span class="aroma-name">${name}</span>
                        <button class="btn-remove-aroma" data-remove-id="${slotId}">Hapus</button>
                    </div>
                    <div class="aroma-slider-group">
                        <input type="range" class="aroma-slider" min="0" max="100" value="0">
                        <div class="aroma-value-display">
                            <input type="text" class="aroma-ml" value="0 ml" readonly>
                            <span class="aroma-percent">0%</span>
                        </div>
                    </div>`;
                slotsContainer.appendChild(slotDiv);
                const bottleLayer = document.createElement('div');
                bottleLayer.className = 'bottle-layer';
                bottleLayer.id = `layer-${slotId}`;
                bottleLayer.style.backgroundColor = color;
                bottleVisual.appendChild(bottleLayer);
            }

            function removeAromaSlot(id) {
                const slot = document.getElementById(id);
                const layer = document.getElementById(`layer-${id}`);
                if (slot) slot.remove();
                if (layer) layer.remove();
                updateValues(); 
            }

            // [BARU] Fungsi Kalkulasi Harga
            function calculateTotal() {
                const size = getCurrentBottleSize();
                const concentrationCost = getCurrentConcentrationCost();
                const bottleBasePrice = BOTTLE_PRICES[size] || 0;

                // Harga Bibit = Ukuran botol * Harga per ml (Asumsi full essence)
                // Atau: Jika ingin harga bibit berdasarkan % terisi, kalikan dengan (totalPercent/100)
                // Sesuai prompt, kita pakai logika sederhana: Ukuran Botol * 2000
                const essenceCost = size * ESSENCE_PRICE_PER_ML;

                const total = bottleBasePrice + essenceCost + concentrationCost;
                
                // Format ke Rupiah
                totalPriceDisplay.textContent = 'Rp ' + total.toLocaleString('id-ID');
            }

            function updateValues(changedSlider = null) {
                const allSliders = document.querySelectorAll('.aroma-slider');
                let totalPercent = 0;
                const currentBottleSize = getCurrentBottleSize();

                allSliders.forEach(slider => {
                    totalPercent += parseInt(slider.value, 10);
                });

                if (totalPercent > 100 && changedSlider) {
                    const excess = totalPercent - 100;
                    changedSlider.value = parseInt(changedSlider.value, 10) - excess;
                    updateValues();
                    return;
                }
                
                let finalTotal = 0;
                allSliders.forEach(slider => {
                    const value = parseInt(slider.value, 10);
                    finalTotal += value;
                    const slot = slider.closest('.aroma-slot');
                    const mlInput = slot.querySelector('.aroma-ml');
                    const percentSpan = slot.querySelector('.aroma-percent');
                    const mlValue = (value / 100) * currentBottleSize;
                    mlInput.value = mlValue.toLocaleString('id-ID', { maximumFractionDigits: 1 }) + ' ml'; 
                    percentSpan.textContent = value + '%';
                    const layer = document.getElementById(`layer-${slot.id}`);
                    if(layer) layer.style.height = value + '%';
                });

                totalProgressBar.style.width = finalTotal + '%';
                totalPercentText.textContent = `Total: ${finalTotal}% / 100%`;

                if (finalTotal === 100) {
                    totalPercentText.style.color = 'var(--color-text-dark)';
                    totalWarning.style.display = 'none';
                    totalProgressBar.style.backgroundColor = 'var(--color-accent-gold)';
                    saveBtn.disabled = false;
                    orderBtn.disabled = false;
                } else {
                    totalPercentText.style.color = 'var(--color-danger)';
                    totalWarning.style.display = 'block';
                    totalProgressBar.style.backgroundColor = 'var(--color-danger)';
                    saveBtn.disabled = true;
                    orderBtn.disabled = true;
                }

                // [BARU] Panggil hitung harga setiap kali ada perubahan
                calculateTotal();
                
            }
                

            // --- EVENT LISTENERS ---
            addAromaBtn.addEventListener('click', openAromaModal);
            modalCloseBtn.addEventListener('click', closeAromaModal);
            modal.addEventListener('click', (e) => { if (e.target === modal) closeAromaModal(); });
            
            // Listener perubahan ukuran botol (juga update harga)
            bottleSizeRadios.forEach(radio => {
                radio.addEventListener('change', () => { updateValues(); });
            });

            // [BARU] Listener perubahan ketahanan (update harga)
            ketahananRadios.forEach(radio => {
                radio.addEventListener('change', () => { calculateTotal(); });
            });

            aromaChoices.forEach(choice => {
                choice.addEventListener('click', () => {
                    const name = choice.dataset.name;
                    const color = choice.dataset.color;
                    createAromaSlot(name, color);
                    closeAromaModal();
                    updateValues();
                });
            });
            
            slotsContainer.addEventListener('input', function(e) {
                if (e.target.classList.contains('aroma-slider')) { updateValues(e.target); }
            });
            
            slotsContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-remove-aroma')) {
                    const slotId = e.target.dataset.removeId;
                    removeAromaSlot(slotId);
                }
            });

            // Init
            updateValues();
        });
    </script>

</body>
</html>